<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main>
      <section id="bug-description">
        <h2>Safari CSS Highlight API Bug</h2>
        <p>
          This demo demonstrates a bug in Safari's implementation of the Custom
          CSS Highlight API. When you position the cursor at the end of a line
          (collapsed selection), Safari incorrectly highlights the entire line
          instead of showing just the cursor position.
        </p>

        <h3>How to reproduce:</h3>
        <ol>
          <li>Open this page in Safari</li>
          <li>Click at the end of any paragraph line in the editor above</li>
          <li>Or click the "Trigger Safari Bug" button in the debug panel</li>
          <li>
            Observe that the entire line gets highlighted in light coral color
          </li>
          <li>
            Check the debug panel - it should show "Collapsed: true" but the
            highlight spans the whole line
          </li>
        </ol>

        <h3>Expected behavior:</h3>
        <p>
          In other browsers (Chrome, Firefox), a collapsed selection at the end
          of a line shows only a cursor position highlight, not the entire line.
        </p>
        
        <p>
          <a href="https://github.com/iam-medvedev/safari-css-highlight-api-bug">Source</a> | 
          <a href="https://bugs.webkit.org/show_bug.cgi?id=297125">WebKit Bug</a>
        </p>
      </section>

      <section id="editor" contenteditable="true" spellcheck="false">
        <p>
          This is the first paragraph. Try clicking here to position your
          cursor.
        </p>
        <p>This is a second paragraph. Click anywhere in this line.</p>
        <p>
          Third paragraph with different content. The bug should appear when you
          just click to position the cursor.
        </p>
        <p>
          Final paragraph for testing. In Safari, you'll see the entire line
          highlighted in green when cursor is positioned.
        </p>
      </section>
    </main>

    <aside id="debug-panel">
      <h3>Selection Debug</h3>
      <div class="debug-info">
        <div class="debug-row">
          <span class="label">Collapsed:</span>
          <span id="debug-collapsed">-</span>
        </div>
        <div class="debug-row">
          <span class="label">Start Offset:</span>
          <span id="debug-start-offset">-</span>
        </div>
        <div class="debug-row">
          <span class="label">End Offset:</span>
          <span id="debug-end-offset">-</span>
        </div>
      </div>
      
      <div class="debug-buttons">
        <button id="trigger-bug-btn" type="button">Trigger Safari Bug</button>
      </div>
    </aside>
    <script src="./index.ts" type="module"></script>
  </body>
</html>
